# coding = utf8
"""
@author: Yantong Lai
@date: 2019.11.4
"""

import torch
import torch.nn as nn
import torch.optim as optim
import torch.nn.functional as F


########## Dataset ##########
training_data = [('I', 'PRON'), ('have', 'VERB'), ('used', 'VERB'), ('transfers', 'NOUN'), ('on', 'ADP'), ('three', 'NUM'), ('occasions', 'NOUN'), ('now', 'ADV'), ('and', 'CONJ'), ('each', 'DET'), ('time', 'NOUN'), ('I', 'PRON'), ('have', 'VERB'), ('been', 'VERB'), ('very', 'ADV'), ('impressed', 'VERB'), ('with', 'ADP'), ('the', 'DET'), ('standard', 'NOUN'), ('of', 'ADP'), ('service', 'NOUN'), ('punctual', 'ADJ'), ('pick', 'NOUN'), ('ups', 'NOUN'), ('and', 'CONJ'), ('helpful', 'ADJ'), ('and', 'CONJ'), ('friendly', 'ADJ'), ('drivers', 'NOUN'), ('IT', 'PRON'), ('CLEARLY', 'ADV'), ('STATED', 'VERB'), ('DELIVERY', 'NOUN'), ('BY', 'ADP'), ('00PM', 'NOUN'), ('ON', 'ADP'), ('SATURDAY', 'NOUN'), ('I', 'PRON'), ('PAID', 'VERB'), ('OVE', 'ADP'), ('00', 'NUM'), ('00', 'NUM'), ('FOR', 'ADP'), ('THIS', 'DET'), ('SERVICE', 'NOUN'), ('AND', 'CONJ'), ('IT', 'PRON'), ('WAS', 'VERB'), ('NOT', 'ADV'), ('PROVIDED', 'VERB'), ('I', 'PRON'), ('WOULD', 'VERB'), ('LIKE', 'VERB'), ('THE', 'DET'), ('PAYMENT', 'NOUN'), ('REFUNDED', 'VERB'), ('AND', 'CONJ'), ('QUITE', 'ADV'), ('FRANKLY', 'ADV'), ('I', 'PRON'), ('AM', 'VERB'), ('DISGUSTED', 'VERB'), ('WITH', 'ADP'), ('INTERPARCEL', 'NOUN'), ('AS', 'ADP'), ('A', 'DET'), ('WHOLE', 'NOUN'), ('A', 'DET'), ('very', 'ADV'), ('happy', 'ADJ'), ('customer', 'NOUN'), ('They', 'PRON'), ('kept', 'VERB'), ('to', 'ADP'), ('the', 'DET'), ('estimated', 'ADJ'), ('worth', 'NOUN'), ('they', 'PRON'), ('had', 'VERB'), ('given', 'VERB'), ('for', 'ADP'), ('my', 'DET'), ('phone', 'NOUN'), ('Name', 'NOUN'), ('O', 'NOUN'), ('T', 'NOUN'), ('I', 'PRON'), ('am', 'VERB'), ('very', 'ADV'), ('sorry', 'ADJ'), ('Do', 'VERB'), ('you', 'PRON'), ('have', 'VERB'), ('an', 'DET'), ('order', 'NOUN'), ('number', 'NOUN'), ('So', 'ADV'), ('even', 'ADV'), ('if', 'CONJ'), ('your', 'VERB'), ('an', 'DET'), ('idiot', 'NOUN'), ('you', 'PRON'), ('can', 'VERB'), ('still', 'ADV'), ('order', 'VERB'), ('the', 'DET'), ('correct', 'ADJ'), ('tyres', 'NOUN'), ('as', 'CONJ'), ('you', 'PRON'), ('only', 'ADV'), ('need', 'VERB'), ('to', 'PRT'), ('put', 'VERB'), ('in', 'PRT'), ('your', 'DET'), ('vehicle', 'NOUN'), ('registration', 'NOUN'), ('"', '.'), ('very', 'ADV'), ('Poor', 'ADJ'), ('service', 'NOUN'), ('slow', 'ADJ'), ('dispatch', 'NOUN'), ('delivery', 'NOUN'), ('friendly', 'ADJ'), ('but', 'CONJ'), ('Unhelpful', 'ADJ'), ('and', 'CONJ'), ('untrustworthy', 'ADJ'), ('people', 'NOUN'), ('at', 'ADP'), ('the', 'DET'), ('other', 'ADJ'), ('end', 'NOUN'), ('of', 'ADP'), ('the', 'DET'), ('phone', 'NOUN'), ('or', 'CONJ'), ('keyboard', 'NOUN'), ('"', '.'), ('Very', 'ADV'), ('poor', 'ADJ'), ('service', 'NOUN'), ('Quidco', 'NOUN'), ('It', 'PRON'), ('took', 'VERB'), ('me', 'PRON'), ('months', 'NOUN'), ('to', 'PRT'), ('eventually', 'ADV'), ('take', 'VERB'), ('the', 'DET'), ('dealer', 'NOUN'), ('to', 'ADP'), ('court', 'NOUN'), ('well', 'ADV'), ('done', 'VERB'), ('Illumi', 'NOUN'), ('for', 'ADP'), ('a', 'DET'), ('great', 'ADJ'), ('product', 'NOUN'), ('As', 'CONJ'), ('I', 'PRON'), ('live', 'VERB'), ('in', 'ADP'), ('Turkey', 'NOUN'), ('it', 'PRON'), ('is', 'VERB'), ('so', 'ADV'), ('easy', 'ADJ'), ('for', 'ADP'), ('me', 'PRON'), ('to', 'PRT'), ('use', 'VERB'), ('Fragrance', 'NOUN'), ('Direct', 'NOUN'), ('and', 'CONJ'), ('then', 'ADV'), ('have', 'VERB'), ('the', 'DET'), ('order', 'NOUN'), ('sent', 'VERB'), ('to', 'ADP'), ('whichever', 'DET'), ('family', 'NOUN'), ('member', 'NOUN'), ('or', 'CONJ'), ('friend', 'NOUN'), ('who', 'PRON'), ('will', 'VERB'), ('be', 'VERB'), ('visiting', 'VERB'), ('us', 'PRON'), ('next', 'ADJ'), ('It', 'PRON'), ('was', 'VERB'), ('a', 'DET'), ('very', 'ADV'), ('comfortable', 'ADJ'), ('bus', 'NOUN'), ('and', 'CONJ'), ('arrived', 'VERB'), ('at', 'ADP'), ('our', 'DET'), ('resort', 'NOUN'), ('in', 'ADP'), ('the', 'DET'), ('time', 'NOUN'), ('it', 'PRON'), ('stated', 'VERB'), ('This', 'DET'), ('is', 'VERB'), ('a', 'DET'), ('reusme', 'NOUN'), ('of', 'ADP'), ('what', 'PRON'), ('we', 'PRON'), ('experienced', 'VERB'), ('I', 'PRON'), ('received', 'VERB'), ('excellent', 'ADJ'), ('service', 'NOUN'), ('from', 'ADP'), ('an', 'DET'), ('excellent', 'ADJ'), ('company', 'NOUN'), ('I', 'PRON'), ('highly', 'ADV'), ('recommend', 'VERB'), ('them', 'PRON'), ('The', 'DET'), ('mousemats', 'NOUN'), ('were', 'VERB'), ('very', 'ADV'), ('good', 'ADJ'), ('and', 'CONJ'), ('I', 'PRON'), ('was', 'VERB'), ('delighted', 'VERB'), ('with', 'ADP'), ('them', 'PRON'), ('So', 'ADV'), ('heavy', 'ADJ'), ('to', 'PRT'), ('manage', 'VERB'), ('I', 'PRON'), ('ordered', 'VERB'), ('some', 'DET'), ('flea', 'NOUN'), ('spray', 'NOUN'), ('at', 'ADP'), ('a', 'DET'), ('very', 'ADV'), ('reasonable', 'ADJ'), ('price', 'NOUN'), ('and', 'CONJ'), ('the', 'DET'), ('product', 'NOUN'), ('arrived', 'VERB'), ('next', 'ADJ'), ('day', 'NOUN'), ('This', 'DET'), ('service', 'NOUN'), ('can', 'VERB'), ('carry', 'VERB'), ('larger', 'ADJ'), ('and', 'CONJ'), ('heavier', 'ADJ'), ('parcels', 'NOUN'), ('but', 'CONJ'), ('is', 'VERB'), ('not', 'ADV'), ('suitable', 'ADJ'), ('for', 'ADP'), ('pallets', 'NOUN'), ('Goods', 'NOUN'), ('were', 'VERB'), ('delivered', 'VERB'), ('in', 'ADP'), ('great', 'ADJ'), ('condition', 'NOUN'), ('and', 'CONJ'), ('very', 'ADV'), ('well', 'ADV'), ('packed', 'VERB'), ('I', 'PRON'), ('was', 'VERB'), ('very', 'ADV'), ('pleased', 'ADJ'), ('with', 'ADP'), ('the', 'DET'), ('prices', 'NOUN'), ('in', 'ADP'), ('the', 'DET'), ('Petflea', 'NOUN'), ('website', 'NOUN'), ('the', 'DET'), ('Frontline', 'NOUN'), ('flea', 'NOUN'), ('treatment', 'NOUN'), ('price', 'NOUN'), ('especially', 'ADV'), ('I', 'PRON'), ('have', 'VERB'), ('been', 'VERB'), ('a', 'DET'), ('customer', 'NOUN'), ('with', 'ADP'), ('Littlewoods', 'NOUN'), ('for', 'ADP'), ('about', 'ADV'), ('00years', 'NOUN'), ('They', 'PRON'), ('tried', 'VERB'), ('again', 'ADV'), ('a', 'DET'), ('few', 'ADJ'), ('hours', 'NOUN'), ('later', 'ADV'), ('but', 'CONJ'), ('still', 'ADV'), ('no', 'DET'), ('answer', 'NOUN'), ('I', 'PRON'), ('was', 'VERB'), ('sent', 'VERB'), ('emails', 'NOUN'), ('at', 'ADP'), ('each', 'DET'), ('stage', 'NOUN'), ('of', 'ADP'), ('the', 'DET'), ('delivery', 'NOUN'), ('process', 'NOUN'), ('order', 'NOUN'), ('recieved', 'VERB'), ('item', 'NOUN'), ('picked', 'VERB'), ('and', 'CONJ'), ('item', 'NOUN'), ('dispatch', 'NOUN'), ('which', 'PRON'), ('was', 'VERB'), ('very', 'ADV'), ('helpful', 'ADJ'), ('the', 'DET'), ('watch', 'NOUN'), ('was', 'VERB'), ('delivered', 'VERB'), ('today', 'NOUN'), ('it', 'PRON'), ('was', 'VERB'), ('ordered', 'VERB'), ('on', 'ADP'), ('the', 'DET'), ('Sunday', 'NOUN'), ('afternoon', 'NOUN'), ('and', 'CONJ'), ('delivered', 'VERB'), ('on', 'ADP'), ('the', 'DET'), ('Wednesday', 'NOUN'), ('morning', 'NOUN'), ('and', 'CONJ'), ('I', 'PRON'), ('am', 'VERB'), ('delighted', 'ADJ'), ('with', 'ADP'), ('it', 'PRON'), ('as', 'ADP'), ('I', 'PRON'), ('hope', 'VERB'), ('my', 'DET'), ('grandson', 'NOUN'), ('will', 'VERB'), ('be', 'VERB'), ('I', 'PRON'), ('think', 'VERB'), ('Ludivine', 'NOUN'), ('will', 'VERB'), ('love', 'VERB'), ('it', 'PRON'), ('and', 'CONJ'), ('when', 'ADV'), ('we', 'PRON'), ('have', 'VERB'), ('the', 'DET'), ('baby', 'NOUN'), ('s', 'PRT'), ('photograph', 'NOUN'), ('in', 'ADP'), ('it', 'PRON'), ('Wow', 'X'), ('Discount', 'NOUN'), ('codes', 'NOUN'), ('always', 'ADV'), ('available', 'ADJ'), ('although', 'CONJ'), ('I', 'PRON'), ('don', 'VERB'), ('t', 'PRT'), ('usually', 'ADV'), ('receive', 'VERB'), ('vouchers', 'NOUN'), ('but', 'CONJ'), ('my', 'DET'), ('Boden', 'NOUN'), ('buying', 'ADJ'), ('friends', 'NOUN'), ('do', 'VERB'), ('These', 'PRON'), ('are', 'VERB'), ('wonderful', 'ADJ'), ('Everything', 'NOUN'), ('went', 'VERB'), ('so', 'ADV'), ('smoothly', 'ADV'), ('For', 'ADP'), ('the', 'DET'), ('price', 'NOUN'), ('I', 'PRON'), ('paid', 'VERB'), ('for', 'ADP'), ('the', 'DET'), ('Sheraton', 'NOUN'), ('Bunk', 'NOUN'), ('beds', 'NOUN'), ('and', 'CONJ'), ('the', 'DET'), ('London', 'NOUN'), ('mattresses', 'NOUN'), ('I', 'PRON'), ('could', 'VERB'), ('not', 'ADV'), ('be', 'VERB'), ('more', 'ADV'), ('pleased', 'ADJ'), ('However', 'ADV'), ('would', 'VERB'), ('prefer', 'VERB'), ('where', 'ADV'), ('possible', 'ADJ'), ('to', 'PRT'), ('travel', 'VERB'), ('with', 'ADP'), ('jet0', 'NOUN'), ('every', 'DET'), ('time', 'NOUN'), ('Overall', 'ADJ'), ('impression', 'NOUN'), ('good', 'ADJ'), ('and', 'CONJ'), ('easy', 'ADV'), ('to', 'PRT'), ('use', 'VERB'), ('website', 'NOUN'), ('good', 'ADJ'), ('range', 'NOUN'), ('of', 'ADP'), ('products', 'NOUN'), ('not', 'ADV'), ('the', 'DET'), ('cheapest', 'ADJ'), ('by', 'ADP'), ('far', 'ADV'), ('but', 'CONJ'), ('been', 'VERB'), ('fine', 'ADJ'), ('so', 'ADV'), ('far', 'ADV'), ('for', 'ADP'), ('a', 'DET'), ('fast', 'ADJ'), ('top', 'ADJ'), ('up', 'ADJ'), ('order', 'NOUN'), ('My', 'DET'), ('contact', 'NOUN'), ('was', 'VERB'), ('Lee', 'NOUN'), ('I', 'PRON'), ('have', 'VERB'), ('never', 'ADV'), ('received', 'VERB'), ('such', 'ADV'), ('fantastic', 'ADJ'), ('customer', 'NOUN'), ('service', 'NOUN'), ('before', 'ADP'), ('The', 'DET'), ('man', 'NOUN'), ('at', 'ADP'), ('the', 'DET'), ('end', 'NOUN'), ('was', 'VERB'), ('so', 'ADV'), ('helpful', 'ADJ'), ('understanding', 'ADJ'), ('and', 'CONJ'), ('kind', 'ADJ'), ('The', 'DET'), ('information', 'NOUN'), ('provided', 'ADJ'), ('on', 'ADP'), ('the', 'DET'), ('website', 'NOUN'), ('during', 'ADP'), ('the', 'DET'), ('build', 'NOUN'), ('process', 'NOUN'), ('the', 'DET'), ('quality', 'NOUN'), ('of', 'ADP'), ('the', 'DET'), ('e', 'NOUN'), ('mail', 'NOUN'), ('communication', 'NOUN'), ('and', 'CONJ'), ('the', 'DET'), ('speedy', 'ADJ'), ('and', 'CONJ'), ('accurate', 'ADJ'), ('delivery', 'NOUN'), ('have', 'VERB'), ('all', 'PRON'), ('been', 'VERB'), ('first', 'ADJ'), ('class', 'NOUN'), ('When', 'ADV'), ('family', 'NOUN'), ('visit', 'VERB'), ('no', 'PRON'), ('one', 'PRON'), ('has', 'VERB'), ('to', 'PRT'), ('waste', 'VERB'), ('time', 'NOUN'), ('in', 'ADP'), ('the', 'DET'), ('kitchen', 'NOUN'), ('Three', 'NUM'), ('weeks', 'NOUN'), ('later', 'ADV'), ('I', 'PRON'), ('was', 'VERB'), ('told', 'VERB'), ('they', 'PRON'), ('couldn', 'VERB'), ('t', 'PRT'), ('get', 'VERB'), ('it', 'PRON'), ('and', 'CONJ'), ('I', 'PRON'), ('should', 'VERB'), ('go', 'VERB'), ('elsewhere', 'ADV'), ('and', 'CONJ'), ('I', 'PRON'), ('was', 'VERB'), ('told', 'VERB'), ('that', 'CONJ'), ('it', 'PRON'), ('would', 'VERB'), ('take', 'VERB'), ('up', 'ADP'), ('to', 'ADP'), ('00', 'NUM'), ('days', 'NOUN'), ('to', 'PRT'), ('refund', 'VERB'), ('my', 'DET'), ('money', 'NOUN'), ('which', 'PRON'), ('it', 'PRON'), ('did', 'VERB'), ('Yet', 'ADV'), ('again', 'ADV'), ('good', 'ADJ'), ('service', 'NOUN'), ('from', 'ADP'), ('Market', 'NOUN'), ('Cross', 'NOUN'), ('I', 'PRON'), ('was', 'VERB'), ('looking', 'VERB'), ('for', 'ADP'), ('a', 'DET'), ('watch', 'NOUN'), ('for', 'ADP'), ('my', 'DET'), ('teenage', 'ADJ'), ('grandson', 'NOUN'), ('for', 'ADP'), ('his', 'DET'), ('birthday', 'NOUN'), ('I', 'PRON'), ('found', 'VERB'), ('the', 'DET'), ('watchshop', 'NOUN'), ('from', 'ADP'), ('a', 'DET'), ('web', 'NOUN'), ('search', 'NOUN'), ('Great', 'ADJ'), ('service', 'NOUN'), ('and', 'CONJ'), ('I', 'PRON'), ('ll', 'VERB'), ('not', 'ADV'), ('only', 'ADV'), ('use', 'VERB'), ('this', 'DET'), ('site', 'NOUN'), ('again', 'ADV'), ('but', 'CONJ'), ('I', 'PRON'), ('ll', 'VERB'), ('also', 'ADV'), ('be', 'VERB'), ('recommending', 'VERB'), ('it', 'PRON'), ('to', 'ADP'), ('family', 'NOUN'), ('and', 'CONJ'), ('friends', 'NOUN'), ('An', 'DET'), ('easy', 'ADV'), ('to', 'PRT'), ('navigate', 'VERB'), ('site', 'NOUN'), ('which', 'PRON'), ('I', 'PRON'), ('need', 'VERB'), ('It', 'PRON'), ('had', 'VERB'), ('the', 'DET'), ('tumble', 'NOUN'), ('dryer', 'NOUN'), ('i', 'PRON'), ('wanted', 'VERB'), ('at', 'ADP'), ('a', 'DET'), ('price', 'NOUN'), ('i', 'PRON'), ('liked', 'VERB'), ('so', 'ADV'), ('i', 'PRON'), ('ordered', 'VERB'), ('one', 'PRON'), ('Never', 'ADV'), ('seem', 'VERB'), ('to', 'PRT'), ('get', 'VERB'), ('them', 'PRON'), ('at', 'ADP'), ('low', 'ADJ'), ('prices', 'NOUN'), ('0', 'NUM'), ('days', 'NOUN'), ('after', 'ADP'), ('purchase', 'NOUN'), ('and', 'CONJ'), ('payment', 'NOUN'), ('including', 'VERB'), ('£', 'X'), ('0', 'NUM'), ('00', 'NUM'), ('postage', 'NOUN'), ('was', 'VERB'), ('received', 'VERB'), ('The', 'DET'), ('flight', 'NOUN'), ('was', 'VERB'), ('fine', 'ADJ'), ('and', 'CONJ'), ('the', 'DET'), ('staff', 'NOUN'), ('courteous', 'ADJ'), ('and', 'CONJ'), ('friendly', 'ADJ'), ('I', 'PRON'), ('have', 'VERB'), ('purchased', 'VERB'), ('from', 'ADP'), ('Golfbase', 'NOUN'), ('before', 'ADP'), ('so', 'ADV'), ('I', 'PRON'), ('was', 'VERB'), ('aware', 'ADJ'), ('of', 'ADP'), ('their', 'DET'), ('top', 'ADJ'), ('class', 'NOUN'), ('service', 'NOUN'), ('wendy', 'NOUN'), ('hall', 'NOUN'), ('YES', 'X'), ('IT', 'PRON'), ('IS', 'VERB'), ('Would', 'VERB'), ('definately', 'ADV'), ('use', 'VERB'), ('this', 'DET'), ('company', 'NOUN'), ('again', 'ADV'), ('Delivery', 'NOUN'), ('guaranteed', 'ADJ'), ('by', 'ADP'), ('end', 'NOUN'), ('of', 'ADP'), ('next', 'ADJ'), ('working', 'NOUN'), ('day', 'NOUN'), ('after', 'ADP'), ('collection', 'NOUN'), ('throughout', 'ADP'), ('most', 'ADJ'), ('of', 'ADP'), ('the', 'DET'), ('UK', 'NOUN'), ('mainland', 'NOUN'), ('They', 'PRON'), ('said', 'VERB'), ('it', 'PRON'), ('was', 'VERB'), ('a', 'DET'), ('picking', 'NOUN'), ('error', 'NOUN'), ('and', 'CONJ'), ('sent', 'VERB'), ('them', 'PRON'), ('out', 'PRT'), ('the', 'DET'), ('next', 'ADJ'), ('day', 'NOUN'), ('so', 'ADV'), ('I', 'PRON'), ('had', 'VERB'), ('to', 'PRT'), ('wait', 'VERB'), ('in', 'ADP'), ('for', 'ADP'), ('delivery', 'NOUN'), ('the', 'DET'), ('second', 'ADJ'), ('time', 'NOUN'), ('on', 'ADP'), ('the', 'DET'), ('00th', 'ADJ'), ('December', 'NOUN'), ('we', 'PRON'), ('ordered', 'VERB'), ('a', 'DET'), ('piano', 'NOUN'), ('stool', 'NOUN'), ('for', 'ADP'), ('my', 'DET'), ('sons', 'NOUN'), ('birthday', 'NOUN'), ('0st', 'ADJ'), ('Jan', 'NOUN')]
word_to_idx = {'I': 0, 'have': 1, 'used': 2, 'transfers': 3, 'on': 4, 'three': 5, 'occasions': 6, 'now': 7, 'and': 8, 'each': 9, 'time': 10, 'been': 11, 'very': 12, 'impressed': 13, 'with': 14, 'the': 15, 'standard': 16, 'of': 17, 'service': 18, 'punctual': 19, 'pick': 20, 'ups': 21, 'helpful': 22, 'friendly': 23, 'drivers': 24, 'IT': 25, 'CLEARLY': 26, 'STATED': 27, 'DELIVERY': 28, 'BY': 29, '00PM': 30, 'ON': 31, 'SATURDAY': 32, 'PAID': 33, 'OVE': 34, '00': 35, 'FOR': 36, 'THIS': 37, 'SERVICE': 38, 'AND': 39, 'WAS': 40, 'NOT': 41, 'PROVIDED': 42, 'WOULD': 43, 'LIKE': 44, 'THE': 45, 'PAYMENT': 46, 'REFUNDED': 47, 'QUITE': 48, 'FRANKLY': 49, 'AM': 50, 'DISGUSTED': 51, 'WITH': 52, 'INTERPARCEL': 53, 'AS': 54, 'A': 55, 'WHOLE': 56, 'happy': 57, 'customer': 58, 'They': 59, 'kept': 60, 'to': 61, 'estimated': 62, 'worth': 63, 'they': 64, 'had': 65, 'given': 66, 'for': 67, 'my': 68, 'phone': 69, 'Name': 70, 'O': 71, 'T': 72, 'am': 73, 'sorry': 74, 'Do': 75, 'you': 76, 'an': 77, 'order': 78, 'number': 79, 'So': 80, 'even': 81, 'if': 82, 'your': 83, 'idiot': 84, 'can': 85, 'still': 86, 'correct': 87, 'tyres': 88, 'as': 89, 'only': 90, 'need': 91, 'put': 92, 'in': 93, 'vehicle': 94, 'registration': 95, '"': 96, 'Poor': 97, 'slow': 98, 'dispatch': 99, 'delivery': 100, 'but': 101, 'Unhelpful': 102, 'untrustworthy': 103, 'people': 104, 'at': 105, 'other': 106, 'end': 107, 'or': 108, 'keyboard': 109, 'Very': 110, 'poor': 111, 'Quidco': 112, 'It': 113, 'took': 114, 'me': 115, 'months': 116, 'eventually': 117, 'take': 118, 'dealer': 119, 'court': 120, 'well': 121, 'done': 122, 'Illumi': 123, 'a': 124, 'great': 125, 'product': 126, 'As': 127, 'live': 128, 'Turkey': 129, 'it': 130, 'is': 131, 'so': 132, 'easy': 133, 'use': 134, 'Fragrance': 135, 'Direct': 136, 'then': 137, 'sent': 138, 'whichever': 139, 'family': 140, 'member': 141, 'friend': 142, 'who': 143, 'will': 144, 'be': 145, 'visiting': 146, 'us': 147, 'next': 148, 'was': 149, 'comfortable': 150, 'bus': 151, 'arrived': 152, 'our': 153, 'resort': 154, 'stated': 155, 'This': 156, 'reusme': 157, 'what': 158, 'we': 159, 'experienced': 160, 'received': 161, 'excellent': 162, 'from': 163, 'company': 164, 'highly': 165, 'recommend': 166, 'them': 167, 'The': 168, 'mousemats': 169, 'were': 170, 'good': 171, 'delighted': 172, 'heavy': 173, 'manage': 174, 'ordered': 175, 'some': 176, 'flea': 177, 'spray': 178, 'reasonable': 179, 'price': 180, 'day': 181, 'carry': 182, 'larger': 183, 'heavier': 184, 'parcels': 185, 'not': 186, 'suitable': 187, 'pallets': 188, 'Goods': 189, 'delivered': 190, 'condition': 191, 'packed': 192, 'pleased': 193, 'prices': 194, 'Petflea': 195, 'website': 196, 'Frontline': 197, 'treatment': 198, 'especially': 199, 'Littlewoods': 200, 'about': 201, '00years': 202, 'tried': 203, 'again': 204, 'few': 205, 'hours': 206, 'later': 207, 'no': 208, 'answer': 209, 'emails': 210, 'stage': 211, 'process': 212, 'recieved': 213, 'item': 214, 'picked': 215, 'which': 216, 'watch': 217, 'today': 218, 'Sunday': 219, 'afternoon': 220, 'Wednesday': 221, 'morning': 222, 'hope': 223, 'grandson': 224, 'think': 225, 'Ludivine': 226, 'love': 227, 'when': 228, 'baby': 229, 's': 230, 'photograph': 231, 'Wow': 232, 'Discount': 233, 'codes': 234, 'always': 235, 'available': 236, 'although': 237, 'don': 238, 't': 239, 'usually': 240, 'receive': 241, 'vouchers': 242, 'Boden': 243, 'buying': 244, 'friends': 245, 'do': 246, 'These': 247, 'are': 248, 'wonderful': 249, 'Everything': 250, 'went': 251, 'smoothly': 252, 'For': 253, 'paid': 254, 'Sheraton': 255, 'Bunk': 256, 'beds': 257, 'London': 258, 'mattresses': 259, 'could': 260, 'more': 261, 'However': 262, 'would': 263, 'prefer': 264, 'where': 265, 'possible': 266, 'travel': 267, 'jet0': 268, 'every': 269, 'Overall': 270, 'impression': 271, 'range': 272, 'products': 273, 'cheapest': 274, 'by': 275, 'far': 276, 'fine': 277, 'fast': 278, 'top': 279, 'up': 280, 'My': 281, 'contact': 282, 'Lee': 283, 'never': 284, 'such': 285, 'fantastic': 286, 'before': 287, 'man': 288, 'understanding': 289, 'kind': 290, 'information': 291, 'provided': 292, 'during': 293, 'build': 294, 'quality': 295, 'e': 296, 'mail': 297, 'communication': 298, 'speedy': 299, 'accurate': 300, 'all': 301, 'first': 302, 'class': 303, 'When': 304, 'visit': 305, 'one': 306, 'has': 307, 'waste': 308, 'kitchen': 309, 'Three': 310, 'weeks': 311, 'told': 312, 'couldn': 313, 'get': 314, 'should': 315, 'go': 316, 'elsewhere': 317, 'that': 318, 'days': 319, 'refund': 320, 'money': 321, 'did': 322, 'Yet': 323, 'Market': 324, 'Cross': 325, 'looking': 326, 'teenage': 327, 'his': 328, 'birthday': 329, 'found': 330, 'watchshop': 331, 'web': 332, 'search': 333, 'Great': 334, 'll': 335, 'this': 336, 'site': 337, 'also': 338, 'recommending': 339, 'An': 340, 'navigate': 341, 'tumble': 342, 'dryer': 343, 'i': 344, 'wanted': 345, 'liked': 346, 'Never': 347, 'seem': 348, 'low': 349, '0': 350, 'after': 351, 'purchase': 352, 'payment': 353, 'including': 354, '£': 355, 'postage': 356, 'flight': 357, 'staff': 358, 'courteous': 359, 'purchased': 360, 'Golfbase': 361, 'aware': 362, 'their': 363, 'wendy': 364, 'hall': 365, 'YES': 366, 'IS': 367, 'Would': 368, 'definately': 369, 'Delivery': 370, 'guaranteed': 371, 'working': 372, 'collection': 373, 'throughout': 374, 'most': 375, 'UK': 376, 'mainland': 377, 'said': 378, 'picking': 379, 'error': 380, 'out': 381, 'wait': 382, 'second': 383, '00th': 384, 'December': 385, 'piano': 386, 'stool': 387, 'sons': 388, '0st': 389, 'Jan': 390}
tag_to_idx = {'PRON': 0, 'VERB': 1, 'NOUN': 2, 'ADP': 3, 'NUM': 4, 'ADV': 5, 'CONJ': 6, 'DET': 7, 'ADJ': 8, 'PRT': 9, '.': 10, 'X': 11}


########## Parameters ##########
EMBEDDING_DIM = 12
HIDDEN_DIM = 6
NUM_EPOCHS = 3


########## Pre-paration ##########
def prepare_sequence(seq, to_ix):
    """
    It is a function to change index to tensor.
    """
    idxs = [to_ix[w] for w in seq]
    return torch.tensor(idxs, dtype=torch.long)


########## Model ##########
class BiLSTMTagger(nn.Module):

    def __init__(self, embedding_dim, hidden_dim, vocab_size, tagset_size):
        super(BiLSTMTagger, self).__init__()
        self.hidden_dim = hidden_dim
        self.word_embeddings = nn.Embedding(vocab_size, tagset_size)

        # The LSTM takes word embeddings as inputs, and outputs hidden states
        self.lstm = nn.LSTM(embedding_dim, hidden_dim, bidirectional=True, num_layers=2, batch_first=True)

        # The linear layer that maps from hidden state space to tag space
        self.hidden2tag = nn.Linear(in_features=hidden_dim * 2, out_features=tagset_size)

    def forward(self, sentence):
        embeds = self.word_embeddings(sentence)
        lstm_out, _ = self.lstm(embeds.view(len(sentence), 1, -1))
        tag_space = self.hidden2tag(lstm_out.view(len(sentence), -1))
        tag_scores = F.log_softmax(tag_space, dim=1)
        return tag_scores

model = BiLSTMTagger(embedding_dim=EMBEDDING_DIM,
                     hidden_dim=HIDDEN_DIM,
                     vocab_size=len(word_to_idx),
                     output_size=len(tag_to_idx))

loss_function = nn.NLLLoss()
optimizer = optim.SGD(model.parameters(), lr=0.1)


########## Training ##########
# Before training
with torch.no_grad():
    inputs = prepare_sequence(training_data[0][0], word_to_idx)
    tag_scores = model(inputs)
    print("Before training, tag_scores = {}".format(tag_scores))
    print("Before training, tag_scores.size() = {}".format(tag_scores.size()))
    # (1, 12)

# Training
for epoch in range(NUM_EPOCHS):
    model.train()
    for sentence, tags in training_data:
        total_loss = []
        model.zero_grad()
        sentence_in = torch.tensor([word_to_idx[sentence]])
        targets = torch.tensor([tag_to_idx[tags]])

        tag_scores = model(sentence_in)
        loss = loss_function(tag_scores, targets)
        loss.backward()
        optimizer.step()
        total_loss.append(loss.item())

    print("total_loss = {}".format(total_loss))